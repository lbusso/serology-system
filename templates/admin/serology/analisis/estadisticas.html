{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}{% trans "Estadísticas de Análisis" %}{% endblock %}

{% block content %}
  <div class="content" style="max-width: 1000px; margin: auto;">
    <h1 style="text-align: center; margin-bottom: 24px;">
      {% trans "Estadísticas de Análisis" %}
    </h1>
    <p style="text-align: center; color: #666; margin-bottom: 40px;">
      {% trans "Distribución por tipo de análisis y por estado." %}
    </p>

    <!-- Contenedor en grid -->
    <div style="
        display: grid;
        grid-template-columns: 1fr;
        gap: 24px;
      "
      class="grid-graficos"
    >
      <!-- Gráfico por tipo -->
      <div style="background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
        <h3 style="text-align: center; margin-bottom: 16px;">{% trans "Análisis por tipo" %}</h3>
        <div style="height: 400px;">
          <canvas id="chartPorTipo"></canvas>
        </div>
      </div>

      <!-- Gráfico por estado -->
      <div style="background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
        <h3 style="text-align: center; margin-bottom: 16px;">{% trans "Análisis por estado" %}</h3>
        <div style="height: 400px;">
          <canvas id="chartPorEstado"></canvas>
        </div>
      </div>
    </div>
  </div>

  {{ labels|json_script:"labels-data" }}
  {{ data|json_script:"values-data" }}
  {{ estados_labels|json_script:"estados-labels" }}
  {{ estados_data|json_script:"estados-values" }}

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const labels = JSON.parse(document.getElementById('labels-data').textContent);
    const values = JSON.parse(document.getElementById('values-data').textContent);
    const estadosLabels = JSON.parse(document.getElementById('estados-labels').textContent);
    const estadosValues = JSON.parse(document.getElementById('estados-values').textContent);

    const palette = [
      '#4e79a7', '#f28e2b', '#e15759', '#76b7b2', '#59a14f',
      '#edc949', '#af7aa1', '#ff9da7', '#9c755f', '#bab0ab'
    ];

    // Bar: Por tipo de análisis
    const ctxTipo = document.getElementById('chartPorTipo').getContext('2d');
    new Chart(ctxTipo, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Cantidad',
          data: values,
          backgroundColor: labels.map((_, i) => palette[i % palette.length])
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
      }
    });

    // Doughnut: Por estado
    const ctxEstado = document.getElementById('chartPorEstado').getContext('2d');
    new Chart(ctxEstado, {
      type: 'doughnut',
      data: {
        labels: estadosLabels,
        datasets: [{
          data: estadosValues,
          backgroundColor: estadosLabels.map((_, i) => palette[i % palette.length])
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: 'bottom' } }
      }
    });
  </script>

  <style>
    /* Grid responsivo */
    @media (min-width: 900px) {
      .grid-graficos {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
{% endblock %}
